<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>簿記1級クイズゲーム</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f9f9f9;
    }
    .container, #categoryArea, #quizArea, #resultArea {
      display: none;
    }
    .option-button {
      display: inline-block;
      margin: 5px 0;
      padding: 10px 20px;
      font-size: 16px;
      background-color: #4caf50;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    .option-button:hover {
      background-color: #45a049;
    }
    #questionText {
      font-size: 18px;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>
  <div id="categoryArea">
    <h2>カテゴリを選択してください</h2>
    <div id="categories"></div>
  </div>
  <div id="quizArea">
    <div id="questionText"></div>
    <div id="answers"></div>
    <input type="text" id="writtenAnswer" style="display: none;" />
    <button id="submitAnswerButton" style="display: none;">回答する</button>
  </div>
  <div id="resultArea">
    <h2>結果</h2>
    <div id="result"></div>
    <button id="restartButton">再挑戦</button>
  </div>
  <script>
    // GitHub PagesでホストされたJSONデータのURLを指定
    const dataUrl = "https://Kurokuro12.github.io/quiz-game/quiz-data.json";

    let questions = [];
    let currentQuestionIndex = 0;
    let filteredQuestions = [];
    let playerAnswers = [];

    // データを取得する関数
    async function fetchQuestions() {
      try {
        const response = await fetch(dataUrl);
        if (!response.ok) {
          throw new Error("データの取得に失敗しました");
        }
        questions = await response.json();
        showCategories();
      } catch (error) {
        alert("エラーが発生しました: " + error.message);
      }
    }

    function showCategories() {
      const categories = [...new Set(questions.map(q => q.category))];
      const categoriesDiv = document.getElementById("categories");
      categoriesDiv.innerHTML = "";
      categories.forEach(category => {
        const button = document.createElement("button");
        button.textContent = category;
        button.classList.add("option-button");
        button.addEventListener("click", () => selectCategory(category));
        categoriesDiv.appendChild(button);
      });
      document.getElementById("categoryArea").style.display = "block";
    }

    function selectCategory(category) {
      filteredQuestions = questions.filter(q => q.category === category);
      currentQuestionIndex = 0;
      playerAnswers = [];
      document.getElementById("categoryArea").style.display = "none";
      document.getElementById("quizArea").style.display = "block";
      showQuestion();
    }

    function showQuestion() {
      if (currentQuestionIndex >= filteredQuestions.length) {
        showResult();
        return;
      }

      const question = filteredQuestions[currentQuestionIndex];
      document.getElementById("questionText").textContent = question.question;
      const answers = document.getElementById("answers");
      const writtenAnswer = document.getElementById("writtenAnswer");
      const submitAnswerButton = document.getElementById("submitAnswerButton");

      answers.innerHTML = "";
      writtenAnswer.style.display = "none";
      submitAnswerButton.style.display = "none";

      if (question.options) {
        question.options.forEach((option, index) => {
          const button = document.createElement("button");
          button.textContent = option;
          button.classList.add("option-button");
          button.addEventListener("click", () => handleAnswer(index));
          answers.appendChild(button);
        });
      } else {
        writtenAnswer.style.display = "block";
        submitAnswerButton.style.display = "block";
        submitAnswerButton.onclick = () => handleAnswer(writtenAnswer.value.trim());
      }
    }

    function handleAnswer(selectedAnswer) {
      const question = filteredQuestions[currentQuestionIndex];
      const isCorrect = question.options
        ? selectedAnswer === question.answer
        : selectedAnswer.toString() === question.answer.toString();
      playerAnswers.push({
        question: question.question,
        selected: question.options ? question.options[selectedAnswer] : selectedAnswer,
        correct: question.options ? question.options[question.answer] : question.answer,
        explanation: question.explanation,
        isCorrect
      });
      currentQuestionIndex++;
      showQuestion();
    }

    function showResult() {
      document.getElementById("quizArea").style.display = "none";
      const resultDiv = document.getElementById("result");
      resultDiv.innerHTML = playerAnswers.map((answer, index) => `
        <div>
          <h3>問題 ${index + 1}</h3>
          <p>あなたの回答: ${answer.selected || "未回答"}</p>
          <p>正解: ${answer.correct}</p>
          <p>${answer.isCorrect ? "正解！" : "不正解"}</p>
          <p>解説: ${answer.explanation}</p>
        </div>
      `).join("");
      document.getElementById("resultArea").style.display = "block";
    }

    document.addEventListener("DOMContentLoaded", fetchQuestions);
  </script>
</body>
</html>
